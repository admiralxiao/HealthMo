# 发布监控与回滚（Crash / Logs / Health Check）— MVP v1

更新时间：2026-01-29

---

## 1. 崩溃监控（必须）
任选其一（MVP 推荐任意先接入一种）：
- Sentry
- Firebase Crashlytics

最小要求：
- iOS 崩溃率
- top crashes
- 版本分布

---

## 2. 后端监控（MVP 最小）
- `/healthz`：返回 ok + db connectivity
- 日志：
  - request_id
  - status
  - latency_ms
- 指标：
  - 5xx rate
  - p95 latency
  - DB connection errors

---

## 3. 发布策略
- TestFlight：
  - 内测 3–5 人（至少 2 台真机）
  - 覆盖权限拒绝、断网、订阅
- App Store：
  - Phased Release 7 天
  - 若 crash spike：暂停发布

---

## 4. 回滚预案
iOS 回滚：
- 不能真正回滚已发布版本 → 通过：
  - 关闭后端新功能（feature flag）
  - 下发禁用开关（remote config 可选）
- 后端回滚：
  - blue/green 或保留上一镜像
  - migrations 必须可回退或兼容

---

## 5. 发布当天 checklist
- [ ] backend /healthz ok
- [ ] DB 备份/快照
- [ ] 订阅 SKU 可用（沙盒 & 生产）
- [ ] 关键埋点入库
- [ ] 重大 bug 0（crash/登录/支付）

---
