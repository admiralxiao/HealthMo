# 风控与反滥用总览（Account / Device / Subscription / Cost）— MVP v1+

更新时间：2026-01-30  
目标：在不伤害正常用户体验的前提下，防止以下滥用：
- **账号滥用**：批量注册、撞库、刷试用、刷权益
- **设备滥用**：越狱/模拟器/Hook 环境绕过逻辑、批量刷接口
- **订阅滥用**：退款/撤销后继续用、重复试用、异常 restore
- **LLM 成本滥用**：拍照识别/文本识别被刷导致成本爆炸
- **API 滥用**：爬取/重放/暴力请求

> 原则：不要“硬拦”。优先采用 **风险评分 → 功能降级 → 二次验证 → 封禁** 的梯度策略。  
> 你已具备：docs/12（远程配置/kill switch）+ docs/07（埋点）+ docs/13（安全加固）。本章补齐闭环。

---

## 1. 风控闭环（从信号到处置）
```mermaid
flowchart LR
  A[Signals\n(telemetry)] --> B[Risk Score\nper user/device]
  B --> C{Policy Decision}
  C -->|allow| D[Normal Experience]
  C -->|degrade| E[Degrade/Throttle]
  C -->|verify| F[Step-up Verification]
  C -->|ban| G[Block + Appeal]
  E --> H[Remote Config\n(kill switches)]
  F --> H
  G --> H
```

---

## 2. MVP 需要覆盖的 4 条“止血路径”
1) **vision 成本爆炸**：throttle + per-user quota + kill_switch.vision  
2) **假 premium**：服务端 entitlement 权威 + premium API 403  
3) **刷 trial**：device 维度计数 + 触发邮箱验证/禁用 trial  
4) **API 暴力请求**：rate limit + App Attest（Level1）+ IP/UA 风险

---

## 3. 风控分层（推荐）
- Layer 0：限频/配额（最有效、最便宜）
- Layer 1：风险评分与降级（体验友好）
- Layer 2：二次验证（强约束：重登、验证码、App Attest）
- Layer 3：封禁与申诉（有误伤成本，需要工具与流程）

---
