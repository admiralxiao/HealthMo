# 后端接口契约（商业化最小集合）— FastAPI

更新时间：2026-01-30

## 1) GET /entitlement
```json
{
  "is_premium": true,
  "product_id": "yearly_59_99",
  "expires_at": "2026-12-31T00:00:00Z",
  "offer_id": "A"
}
```

## 2) POST /iap/transactions
输入：
```json
{
  "transaction_id":"123",
  "original_transaction_id":"orig_456",
  "product_id":"weekly_9_99",
  "signed_transaction":"JWS...",
  "app_receipt":"base64..."
}
```
输出：entitlement（同上）

## 3) GET /risk/state（用于禁折扣/降级）
```json
{ "risk_level":"low", "risk_score":12 }
```

## 4) GET /config/bootstrap（已有 docs/12）
包含 paywall flags/params/providers

## 5) POST /events（可选集中埋点）
```json
{ "events":[{"name":"paywall_view","ts":0,"props":{}}] }
```

## 6) 错误码规范
- 403：无 premium entitlement（premium API）
- 429：限频/配额（vision/购买确认）
客户端遇 403（premium API）应触发 entitlement refresh（见 05）。
