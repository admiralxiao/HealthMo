# 商业化实现细节总览（iOS 状态机 + RemoteConfig + 埋点 + StoreKit2）— MVP v1

更新时间：2026-01-30  
适用：iOS 原生（Swift, iOS 15.6+）+ FastAPI + Postgres  
对齐：
- docs/12 远程配置（bootstrap / flags / params）
- docs/13 会员防破解（服务端 entitlement 权威）
- docs/14 风控（risk → degrade/verify/ban）
- docs/15 商业化与定价（问卷→价值预览→Paywall→Offer）

## 本章交付
1) iOS 页面栈与状态机（软门+二次付费）  
2) Offer 决策：A/B/C（分层折扣触发）  
3) Remote Config 字段与默认值（灰度/止血）  
4) 埋点事件枚举与 payload（增长+风控）  
5) StoreKit2：购买/恢复/监听更新 + 后端上报  
6) 后端接口契约（entitlement / iap / risk / events）  
7) 测试与发布检查（审核/退款/回收/弱网）

## 必须原则（工程强约束）
- Premium 不能本地解锁：**购买后必须后端验证并下发 entitlement** 才解锁  
- Paywall 默认只展示 2 个 plan（weekly + yearly），避免选择瘫痪  
- B/C 折扣必须受远程配置与风控约束（risk>=medium 禁用折扣）  
- kill_switch 必须可在 5 分钟内止血（payments / all）
